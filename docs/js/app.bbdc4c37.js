(function(e){function t(t){for(var n,s,r=t[0],c=t[1],l=t[2],d=0,p=[];d<r.length;d++)s=r[d],Object.prototype.hasOwnProperty.call(o,s)&&o[s]&&p.push(o[s][0]),o[s]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);u&&u(t);while(p.length)p.shift()();return i.push.apply(i,l||[]),a()}function a(){for(var e,t=0;t<i.length;t++){for(var a=i[t],n=!0,r=1;r<a.length;r++){var c=a[r];0!==o[c]&&(n=!1)}n&&(i.splice(t--,1),e=s(s.s=a[0]))}return e}var n={},o={app:0},i=[];function s(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=e,s.c=n,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(a,n,function(t){return e[t]}.bind(null,n));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/note-viewer/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=t,r=r.slice();for(var l=0;l<r.length;l++)t(r[l]);var u=c;i.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"3c08":function(e,t,a){"use strict";a("5081")},5081:function(e,t,a){},"56d7":function(e,t,a){"use strict";a.r(t);a("e260"),a("e6cf"),a("cca6"),a("a79d"),a("534e"),a("f89d");var n=a("2b0e"),o=a("b29a"),i=a.n(o),s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("app-splitter"),a("v-ons-toast",{attrs:{visible:e.visible},on:{"update:visible":function(t){e.visible=t}}},[e._v(" "+e._s(e.visible?e.active.message:"")+" ")])],1)},r=[],c=a("5530"),l=a("2f62"),u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-ons-splitter",[a("v-ons-splitter-side",{attrs:{swipeable:"",side:"left",collapse:"",width:"80%",animation:e.md?"overlay":"reveal","swipe-target-width":e.md&&25,open:e.isOpen},on:{"update:open":function(t){e.isOpen=t}}},[a("Menu")],1),a("v-ons-splitter-content",[a("Home")],1)],1)},d=[],p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-ons-page",[a("v-ons-list",[e.rootNotes.length?a("div",[a("ons-list-header",[e._v("Root")]),e._l(e.rootNotes,(function(t){return a("ons-list-item",{key:t.id,attrs:{modifier:"chevron",tappable:""},on:{click:function(a){return e.selectNote(t.id)}}},[e._v(" "+e._s(t.title)+" ")])}))],2):e._e(),e._l(e.notesItems,(function(t){return[t.folder?a("ons-list-header",{key:t.id},[e._v(" "+e._s(t.title)+" ")]):a("ons-list-item",{key:t.id,attrs:{modifier:"chevron",tappable:""},on:{click:function(a){return e.selectNote(t.id)}}},[e._v(" "+e._s(t.title)+" ")])]}))],2)],1)},h=[],f={name:"Menu",computed:Object(c["a"])({},Object(l["c"])("loader",["notesItems","rootNotes"])),methods:Object(c["a"])({},Object(l["b"])("loader",["selectNote"]))},v=f,m=a("2877"),g=Object(m["a"])(v,p,h,!1,null,null,null),b=g.exports,w=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-ons-page",[a("input",{staticStyle:{display:"none"},attrs:{id:"file-input",type:"file",name:"name",accept:"application/zip"}}),a("toolbar",e._b({},"toolbar",e.toolbarInfo,!1)),a("div",{staticClass:"flex-container"},[a("div",{staticClass:"page-center"},[a("canvas",{directives:[{name:"show",rawName:"v-show",value:e.status.shapeDBLoaded,expression:"status.shapeDBLoaded"}],attrs:{id:"note-canvas"}}),a("v-ons-row",{directives:[{name:"show",rawName:"v-show",value:e.status.shapeDBLoaded&&e.selected,expression:"status.shapeDBLoaded && selected"}]},[a("v-ons-col",[a("v-ons-icon",{staticClass:"arrow-icon",attrs:{size:"2em",icon:"ion-ios-arrow-back, material:md-arrow-left"},on:{click:function(t){return e.navigatePage(!1)}}})],1),a("v-ons-col",{staticClass:"pagination"},[e._v(e._s(e.pagination))]),a("v-ons-col",{staticClass:"arrow-right"},[a("v-ons-icon",{staticClass:"arrow-icon",attrs:{size:"2em",icon:"ion-ios-arrow-forward, material:md-arrow-right"},on:{click:function(t){return e.navigatePage(!0)}}})],1)],1),a("v-ons-icon",{directives:[{name:"show",rawName:"v-show",value:!e.loading&&!e.status.shapeDBLoaded,expression:"!loading && !status.shapeDBLoaded"}],attrs:{size:"2em",icon:"ion-ios-document, material:md-file"},on:{click:function(t){return e.openFileDialog()}}}),a("v-ons-progress-circular",{directives:[{name:"show",rawName:"v-show",value:e.loading&&!e.status.shapeDBLoaded,expression:"loading && !status.shapeDBLoaded"}],attrs:{indeterminate:""}})],1)])],1)},x=[],y=(a("99af"),a("c975"),a("a9e3"),a("b64b"),a("d3b7"),a("25f0"),a("ddb0"),a("96cf"),a("1da1")),O=a("3835"),k=a("c4e3"),D=a.n(k),j=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-ons-toolbar",[a("div",{staticClass:"left"},[a("v-ons-toolbar-button",{on:{click:function(t){return e.$store.commit("splitter/toggle")}}},[a("v-ons-icon",{attrs:{icon:"ion-ios-menu, material:md-menu"}})],1)],1),a("div",{staticClass:"center"},[e._v(" "+e._s(e.title)+" ")])])},_=[],B={name:"Toolbar",props:["title"]},L=B,S=Object(m["a"])(L,j,_,!1,null,null,null),N=S.exports,P={name:"Home",components:{Toolbar:N},data:function(){return{toolbarInfo:{title:"Note Viewer"},zip:null,worker:null,pages:null,currentPage:null,pagination:"",canvas:null,width:null,height:null,ctx:null}},computed:Object(c["a"])({},Object(l["d"])("loader",["status","loading","shapeDB","selected"])),methods:Object(c["a"])(Object(c["a"])({},Object(l["b"])("loader",["startLoading","zipLoaded","badZipFile","badDatabaseFile","shapeDBLoaded","badNoteFile"])),{},{openFileDialog:function(){document.getElementById("file-input").click()},loadShapeDB:function(){var e=this,t=this.zip.file("ShapeDatabase.db");t?t.async("uint8array").then((function(t){e.worker.postMessage({id:"openShapeDB",action:"open",buffer:t})})):this.badDatabaseFile()},parseShapeDB:function(e){for(var t=[],a=0;a<e.length;a++){var n=e[a];if(0===n[25]){var o={id:n[3],folder:0===n[8],createdAt:new Date(n[1]),updatedAt:new Date(n[2]),title:n[6]};if(!o.folder){var i=Object(O["a"])(n,5);o.parent=i[4]}(o.folder||0!==n[26])&&t.push(o)}}this.shapeDBLoaded(t)},loadNote:function(e){var t=this,a=this.zip.file("".concat(e,".db"));a?a.async("uint8array").then((function(e){t.worker.postMessage({id:"openNote",action:"open",buffer:e})})):this.badNoteFile()},parseShapeModel:function(e){for(var t=e.columns.indexOf("pageUniqueId"),a=e.columns.indexOf("color"),n=e.columns.indexOf("thickness"),o=e.columns.indexOf("points"),i=e.columns.indexOf("shapeType"),s=e.values,r={},c=0;c<s.length;c++){var l=s[c][t];r[l]||(r[l]={},r[l].shapes=[]);var u=(s[c][a]>>>0).toString(16).substring(2);r[l].shapes.push({color:u,thickness:s[c][n],points:s[c][o],type:s[c][i]})}this.pages=r;var d=Object.keys(r),p=Object(O["a"])(d,1);this.currentPage=p[0],this.pagination="1/".concat(d.length);var h=this.pages[this.currentPage];this.drawPage(h)},navigatePage:function(e){var t=Object.keys(this.pages),a=t.indexOf(this.currentPage);a=e?a+1:a-1,a=a<0?t.length-1:a,a=a===t.length?0:a,this.currentPage=t[a],this.pagination="".concat(a+1,"/").concat(t.length);var n=this.pages[this.currentPage];this.drawPage(n)},getValues:function(e,t){var a={};return a.x=e.getFloat32(t),a.y=e.getFloat32(t+4),a.pressure=e.getFloat32(t+8),a.size=e.getFloat32(t+12),a.timestamp=Number(e.getBigInt64(t+16)),a},drawPage:function(e){this.ctx.clearRect(0,0,this.width,this.height);for(var t=0;t<e.shapes.length;t++){var a=e.shapes[t],n=new DataView(a.points.buffer);if(this.ctx.strokeStyle="#".concat(a.color),this.ctx.lineWidth=a.thickness,-1!==[0,1,7,8].indexOf(a.type)){var o=this.getValues(n,0),i=this.getValues(n,24),s={x:this.width*o.x,y:this.height*o.y},r={x:this.width*i.x,y:this.height*i.y};switch(a.type){case 0:var c=r.x-s.x,l=r.y-s.y,u={x:r.x-c/2,y:r.y-l/2},d=Math.abs(c/2),p=Math.abs(l/2);this.ctx.beginPath(),this.ctx.ellipse(u.x,u.y,d,p,0,0,2*Math.PI),this.ctx.stroke();break;case 1:var h=r.x-s.x,f=r.y-s.y;this.ctx.strokeRect(s.x,s.y,h,f);break;case 7:this.ctx.beginPath(),this.ctx.moveTo(s.x,s.y),this.ctx.lineTo(r.x,r.y),this.ctx.stroke();break;case 8:var v=s.x-r.x,m={x:r.x+2*v,y:r.y};this.ctx.beginPath(),this.ctx.moveTo(s.x,s.y),this.ctx.lineTo(r.x,r.y),this.ctx.lineTo(m.x,m.y),this.ctx.closePath(),this.ctx.stroke();break;default:break}}else{var g=a.points.length/24;this.ctx.beginPath();for(var b=0;b<g;b++){var w=this.getValues(n,24*b);0===b?this.ctx.moveTo(this.width*w.x,this.height*w.y):this.ctx.lineTo(this.width*w.x,this.height*w.y)}this.ctx.stroke()}}}}),created:function(){var e=this;return Object(y["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.worker=new Worker("".concat("/note-viewer/","worker.sql-wasm.js")),e.worker.onmessage=function(t){var a=t.data;switch(a.id){case"openShapeDB":e.worker.postMessage({id:"loadShapeDB",action:"exec",sql:"SELECT * FROM NoteModel"});break;case"loadShapeDB":var n=a.results[0].values;e.parseShapeDB(n);break;case"openNote":e.worker.postMessage({id:"loadShapeModel",action:"exec",sql:"SELECT * FROM NewShapeModel"});break;case"loadShapeModel":e.parseShapeModel(a.results[0]);break;default:break}};case 2:case"end":return t.stop()}}),t)})))()},mounted:function(){var e=this,t=document.getElementById("file-input");t.addEventListener("change",(function(){e.startLoading();var a=t.files[0];D.a.loadAsync(a).then((function(t){e.zip=t,e.zipLoaded()}),(function(){e.badZipFile()}))})),this.canvas=document.getElementById("note-canvas"),this.ctx=this.canvas.getContext("2d");var a=window.innerWidth,n=a*(4/3);this.width=a,this.height=n,this.canvas.width=a,this.canvas.height=n},watch:{status:function(e){e.zipLoaded&&this.loadShapeDB()},selected:function(e){this.loadNote(e)}}},M=P,F=(a("3c08"),Object(m["a"])(M,w,x,!1,null,"536a3520",null)),T=F.exports,I={name:"AppSplitter",components:{Menu:b,Home:T},computed:{isOpen:{get:function(){return this.$store.state.splitter.open},set:function(e){this.$store.commit("splitter/toggle",e)}}}},z=I,E=Object(m["a"])(z,u,d,!1,null,null,null),q=E.exports,C={name:"App",components:{AppSplitter:q},computed:Object(c["a"])(Object(c["a"])({},Object(l["c"])("alert",["visible"])),Object(l["d"])("alert",["active"]))},$=C,A=Object(m["a"])($,s,r,!1,null,null,null),R=A.exports,V=3e3,Z=function(e){return setTimeout(e,V)},J={queue:[],active:void 0,timeoutId:void 0},H={visible:function(e){return!!e.active}},Q={enqueue:function(e,t){var a=t.toast;e.queue.push(a)},dequeue:function(e,t){var a=t.timeoutId,n=e.queue.shift();e.active=n,e.timeoutId=a},reset:function(e){var t=e.timeoutId;t&&clearTimeout(t),e.active=void 0,e.timeoutId=void 0}},W={pushToast:function(e,t){var a=e.state,n=e.commit,o=e.dispatch;n("enqueue",{toast:t}),a.active||o("processQueue")},processQueue:function(e){var t=e.state,a=e.commit,n=e.dispatch;if(t.queue.length||t.active){if(!t.queue.length&&t.active)return Z((function(){return a("reset")}));var o=Z((function(){return n("processQueue")}));a("dequeue",{timeoutId:o})}}},U={},G={namespaced:!0,state:J,getters:H,mutations:Q,actions:W,modules:U},K={open:!1},X={},Y={toggle:function(e,t){e.open="boolean"===typeof t?t:!e.open}},ee={},te={},ae={namespaced:!0,state:K,getters:X,mutations:Y,actions:ee,modules:te},ne=(a("4de4"),{status:{},loading:!1,shapeDB:[],selected:""}),oe={notesItems:function(e,t){for(var a=t.folders,n=[],o=function(t){var o=Object(c["a"])({},a[t]);n.push(o);var i=e.shapeDB.filter((function(e){return e.parent===o.id}));i=JSON.parse(JSON.stringify(i)),n=n.concat(i)},i=0;i<a.length;i++)o(i);return n},folders:function(e){return e.shapeDB.filter((function(e){return e.folder}))},rootNotes:function(e){return e.shapeDB.filter((function(e){return null===e.parent}))}},ie={startLoading:function(e){e.loading=!0},zipLoaded:function(e){e.status={},e.status.zipLoaded=!0},badZipFile:function(e){e.status={},e.loading=!1},badDatabaseFile:function(e){e.status={},e.loading=!1},shapeDBLoaded:function(e,t){e.status={},e.status.shapeDBLoaded=!0,e.loading=!1,e.shapeDB=t},selectNote:function(e,t){e.selected=t,e.loading=!0}},se={startLoading:function(e){var t=e.commit;t("startLoading")},zipLoaded:function(e){var t=e.commit;t("zipLoaded")},badZipFile:function(e){var t=e.commit,a=e.dispatch;a("alert/pushToast",{message:"Error while loading backup file!"},{root:!0}),t("badZipFile")},badDatabaseFile:function(e){var t=e.commit,a=e.dispatch;a("alert/pushToast",{message:"Error while loading notes database!"},{root:!0}),t("badDatabaseFile")},shapeDBLoaded:function(e,t){var a=e.commit;a("shapeDBLoaded",t)},selectNote:function(e,t){var a=e.commit;a("splitter/toggle",{},{root:!0}),a("selectNote",t)},badNoteFile:function(e){var t=e.dispatch;t("alert/pushToast",{message:"Error while loading this note data!"},{root:!0})}},re={},ce={namespaced:!0,state:ne,getters:oe,mutations:ie,actions:se,modules:re};n["a"].use(l["a"]);var le=new l["a"].Store({strict:!1,namespaced:!0,state:{},getters:{},mutations:{},actions:{},modules:{alert:G,splitter:ae,loader:ce}});n["a"].use(i.a),n["a"].config.productionTip=!1,new n["a"]({store:le,render:function(e){return e(R)},beforeCreate:function(){n["a"].prototype.md=this.$ons.platform.isAndroid()}}).$mount("#app")}});
//# sourceMappingURL=app.bbdc4c37.js.map